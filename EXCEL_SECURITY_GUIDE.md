# Excel 파일 보안 가이드

## 🔒 개요

현재 `xlsx` 라이브러리 사용으로 인한 보안 취약점을 완화하기 위한 다층 보안 조치를 구현했습니다.

## ⚠️ 보안 취약점

- **Prototype Pollution**: 객체 프로토타입 오염 공격
- **ReDoS**: 정규표현식 서비스 거부 공격
- **Code Injection**: 수식/매크로를 통한 코드 실행

## 🛡️ 구현된 보안 조치

### 1. 파일 크기 제한

- **최대 파일 크기**: 10MB
- **최대 행 수**: 10,000행
- **최대 컬럼 수**: 100컬럼

### 2. 매직바이트 검증

- 확장자 무시하고 실제 파일 형식 검증
- `.xls`, `.xlsx` 파일 시그니처 확인

### 3. 수식 무력화

- 모든 수식(`=SUM()`, `=IF()` 등)을 빈 문자열로 변환
- 위험한 함수명(`EXEC`, `SHELL`, `EVAL`) 감지 및 제거

### 4. 매크로 차단

- VBA 매크로 패턴 감지
- `AUTO_OPEN`, `WORKBOOK_OPEN` 등 이벤트 핸들러 차단

### 5. 압축 폭탄 방어

- ZIP 엔트리 수 제한 (최대 1,000개)
- 압축 해제 전 크기 검사

### 6. 파싱 타임아웃

- 30초 타임아웃으로 DoS 공격 방지
- 장시간 실행되는 파싱 작업 차단

## 🔧 환경변수 설정

```bash
# 파일 크기 제한 (10MB)
EXCEL_MAX_FILE_SIZE=10485760

# 최대 행/컬럼 수
EXCEL_MAX_ROWS=10000
EXCEL_MAX_COLS=100

# 파싱 타임아웃 (30초)
EXCEL_PARSE_TIMEOUT=30000

# 보안 레벨 (strict|moderate|lenient)
EXCEL_SECURITY_LEVEL=strict
```

## 📋 운영 체크리스트

### 배포 전 확인사항

- [ ] `npm audit --audit-level=high` 통과
- [ ] 보안 테스트 실행 (`npm test tests/security/`)
- [ ] 환경변수 설정 확인
- [ ] 로그 모니터링 설정

### 일일 모니터링

- [ ] 보안 경고 로그 확인
- [ ] 업로드 실패율 모니터링
- [ ] 메모리 사용량 확인

### 주간 점검

- [ ] 의존성 보안 업데이트 확인
- [ ] 보안 로그 분석
- [ ] 성능 지표 검토

## 🚨 보안 사고 대응

### 매크로 감지 시

1. 파일 즉시 거부
2. 보안 로그 기록
3. 관리자 알림 발송

### 압축 폭탄 감지 시

1. 파싱 작업 중단
2. 메모리 정리
3. 시스템 리소스 모니터링

### 수식 공격 감지 시

1. 수식 자동 제거
2. 경고 로그 기록
3. 사용자에게 안전한 데이터만 반환

## 🔄 교체 계획

### 단기 (1-2개월)

- 현재 보안 조치 유지
- 사용자 피드백 수집
- 성능 모니터링

### 중기 (3-6개월)

- Excel → CSV 변환 워커 구현
- 사용자 사전 변환 유도
- 업로드 전 파일 검증 강화

### 장기 (6-12개월)

- `exceljs`로 완전 전환
- 하이브리드 시스템 구축
- 클라우드 기반 파싱 서비스 검토

## 📞 연락처

보안 관련 문의나 사고 신고:

- 개발팀: dev@company.com
- 보안팀: security@company.com
- 긴급상황: +82-10-0000-0000

## 📚 참고자료

- [OWASP Excel 보안 가이드](https://owasp.org/)
- [xlsx 보안 취약점 리포트](https://github.com/SheetJS/sheetjs/issues)
- [Excel 파싱 보안 모범 사례](https://example.com)
